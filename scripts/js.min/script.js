var API_Key="api-key=71fcd276-7828-4e87-a78e-a8e7e3eddf49",link="https://content.guardianapis.com/",Default_Error=function(e){0===e.status?alert("Network Problem"):404==e.status?alert("Requested page not found. [404]"):401==e.status?alert("Unauthorised. [401]"):500==e.status?alert("Internal Server Error [500]."):alert("FAIL.")};function getNewsInfo(e,t,s){$.ajax({type:"GET",dataType:"jsonp",cache:!0,url:link+e+API_Key,success:t,error:s})}var displayInfo=function(e){for(var t=sectionName,s=e.response.results,a=0;a<e.response.results.length;a++)$(t).append("<div class='col-md-6 col-lg-3 col-sm-6 mb-5'><div class='card storybtn' data-toggle='modal' data-target='#story_modal' id='"+s[a].id+"'><img class='card-img-top' src='"+s[a].fields.thumbnail+"' alt='Card image cap'><div class='card-body'><h5 class='card-title'>"+s[a].webTitle+"</h5><p class='card-text'><small class='text-muted'>"+s[a].sectionName+"</small></p></div></div>")};function addToFavourites(e){if(localStorage&&localStorage.getItem("favourites")){var t=JSON.parse(localStorage.getItem("favourites"));t.items.push(e),alert("The article has been added to your favourites. Please refresh page to view changes."),localStorage.setItem("favourites",JSON.stringify(t))}}var displayFavs=function(){for(var e=JSON.parse(localStorage.getItem("favourites")).items,t=0;t<e.length;t++)$("#fav_posts").append("<div class='col-md-6 col-lg-3 col-sm-6 mb-5'><div><button class='btn btn-danger' data-id='"+e[t].id+"' id='del_fav'>Delete</button></div><div class='card storybtn' data-toggle='modal' data-target='#story_modal' id='"+e[t].id+"'><img class='card-img-top' src='"+e[t].picture+"' alt='Card image cap'><div class='card-body'><h5 class='card-title'>"+e[t].webTitle+"</h5><p class='card-text'><small class='text-muted'>"+e[t].sectionName+"</small></p></div></div>")};function localsearch(e){var t=section_title;search_result_list="",$("#offlineResults").append("<li class='list-group-item list-group-item-dark'><h6>"+t+"</h6></li>");for(var s=0;s<e.length;s++)e[s].webTitle.toLowerCase().includes($("#searchquery").val().toLowerCase())&&(search_result_list+="<li class='list-group-item'><div class='row'><div class='col'><img class='imglist' alt='weather' src='"+e[s].fields.thumbnail+"' alt='Card image cap'></div><div class='col' data-id='"+e[s].id+"' data-name='"+e[s].webTitle+"' data-section='"+e[s].sectionName+"' data-picture='"+e[s].fields.thumbnail+"'><h6><a target='_blank' href='' data-toggle='modal' data-target='#story_modal' id='"+e[s].id+"' class='storybtn'>"+e[s].webTitle+"</a></h6><p class='card-text'><small class='text-muted'>"+e[s].sectionName+"</small></p><button class='btn btn-primary' id='add_fav'>Add Favourite</button></div></div></li>");""!==search_result_list?$("#offlineResults").append(search_result_list):$("#offlineResults").append("<li class='list-group-item list-group-item-light'><h6>No search results</h6></li>")}$(document).ready(function(){$("#newsResults").hide(),$("#searchResult_div").hide();var e=new Date,t=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate();if($("#date").text(t),null===localStorage.getItem("favourites")){var s={items:[]};localStorage.setItem("favourites",JSON.stringify(s))}$(document).on("click","#add_fav",function(){div=$(this).parent();var e={};e.webTitle=$(div).attr("data-name"),e.id=$(div).attr("data-id"),e.sectionName=$(div).attr("data-section"),e.picture=$(div).attr("data-picture"),addToFavourites(e)}),$(document).on("click","#del_fav",function(){var e=$(this).attr("data-id");favs=JSON.parse(localStorage.getItem("favourites"));for(var t=0;t<favs.items.length;t++)favs.items[t].id==e&&(favs.items.splice(t,1),alert("The article has been deleted. Please refresh page to view changes."));localStorage.setItem("favourites",JSON.stringify(favs))}),$('[data-toggle="tooltip"]').tooltip(),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){var t=e.coords.latitude,s=e.coords.longitude;$.getJSON("http://api.openweathermap.org/data/2.5/weather?lat="+t+"&lon="+s+"&units=imperial&appid=1be108a3d46bf94f18e798103ee6ec09",function(e){var t=e.name,s=Math.round(e.main.temp),a=e.weather[0].description,o="<img src='http://openweathermap.org/img/w/"+e.weather[0].icon+".png'>";$("#displayBox").html("<p>"+t+" "+s+" &deg;F "+a+" "+o+"</p>")})},function(e){e.code==e.PERMISSION_DENIED?$("#displayBox").html("<p>Access to location data has been denied.</p>"):e.code==e.PERMISSION_UNAVAILABLE&&$("#displayBox").html("<p>Unable to access geolocation data.</p>")}),getNewsInfo("search?&show-fields=thumbnail&order-by=newest&show-most-viewed=true&page-size=4&",function(e){sectionName="#popular",popular_stories=e.response.results,localStorage.setItem("popular",JSON.stringify(popular_stories)),console.log(e),displayInfo(e)}),getNewsInfo("search?&section=sport&order-by=newest&show-fields=thumbnail&page-size=8&",function(e){sectionName="#sports_posts",console.log(e),displayInfo(e)}),getNewsInfo("search?&section=science&order-by=newest&show-fields=thumbnail&page-size=8&",function(e){sectionName="#science_posts",science_stories=e.response.results,localStorage.setItem("science",JSON.stringify(science_stories)),console.log(e),displayInfo(e)}),getNewsInfo("search?&section=world&order-by=newest&show-fields=thumbnail&page-size=8&",function(e){sectionName="#world_posts",console.log(e),displayInfo(e)}),getNewsInfo("search?&section=technology&order-by=newest&show-fields=thumbnail&page-size=8&",function(e){sectionName="#technology_posts",technology_stories=e.response.results,localStorage.setItem("tech",JSON.stringify(technology_stories)),console.log(e),displayInfo(e)}),getNewsInfo("search?&section=politics&order-by=newest&show-fields=thumbnail&page-size=8&",function(e){sectionName="#politics_posts",politics_stories=e.response.results,console.log(e),displayInfo(e)}),getNewsInfo("search?&section=culture&order-by=newest&show-fields=thumbnail&page-size=8&",function(e){ent_stories=e.response.results,localStorage.setItem("entertainment",JSON.stringify(ent_stories)),sectionName="#entertainment_posts",console.log(e),displayInfo(e)}),displayFavs(),$(document).on("mousedown",".storybtn",function(){getNewsInfo($(this).attr("id")+"?show-fields=thumbnail%2CbodyText&",function(e){var t=e.response.content;$("#story_img").attr("src",t.fields.thumbnail),$("#story_link").attr("href",t.webUrl),$("#story_title").text(t.webTitle),$("#story_content").text(t.fields.bodyText)})}),$("#read_More").on("click",function(){$(this).parent().toggleClass("showContent");var e=$(this).parent().hasClass("showContent")?"Read Less":"Read More";$(this).text(e)}),$("#clearbtn").on("click",function(e){e.preventDefault,$("#searchResult_div").hide(),$("#nav_tabs").show()}),$("#searchbtn").on("click",function(e){e.preventDefault();let t=$("#searchquery").val(),s="https://content.guardianapis.com/search?&order-by=newest&show-fields=bodyText,thumbnail&q="+t+"&api-key=71fcd276-7828-4e87-a78e-a8e7e3eddf49";""!==t?$.ajax({url:s,method:"GET",dataType:"jsonp",complete:function(){output="",$("#offlineResults").html(output),$("#nav_tabs").hide(),$("#newsResults").fadeIn(),$("#searchResult_div").fadeIn();var e=JSON.parse(localStorage.getItem("popular"));section_title="Popular News",localsearch(e);var t=JSON.parse(localStorage.getItem("science"));section_title="Science News",localsearch(t);var s=JSON.parse(localStorage.getItem("tech"));section_title="Technology News",localsearch(s);var a=JSON.parse(localStorage.getItem("politics"));section_title="Politics News",localsearch(a);var o=JSON.parse(localStorage.getItem("entertainment"));section_title="Entertainment News",localsearch(o);var i=JSON.parse(localStorage.getItem("sports"));section_title="Sports News",localsearch(i)},success:function(e){var t="",s=e.response.results;for(var a in s)t+="<li class='list-group-item'><div class='row'><div class='col'><img class='imglist' src='"+s[a].fields.thumbnail+"' alt='Card image cap'></div><div class='col' data-id='"+s[a].id+"' data-name='"+s[a].webTitle+"' data-section='"+s[a].sectionName+"' data-picture='"+s[a].fields.thumbnail+"'><h6><a target='_blank' href='' data-toggle='modal' data-target='#story_modal' id='"+s[a].id+"' class='storybtn'>"+s[a].webTitle+"</a></h6><p class='card-text'><small class='text-muted'>"+s[a].sectionName+"</small></p><button class='btn btn-primary' id='add_fav'>Add Favourite</button></div></div></li>";if(""!==t)$("#newsResults").html(t);else{$("#newsResults").html("<li class='list-group-item list-group-item-light'><h6>No search results</h6></li>")}},error:function(){console.log("error")}}):alert("please enter something to search")}),$(function(){$("#section_nav").on("click",function(){var e=$(this.hash);if((e=e.length?e:$("[name="+this.hash.substr(1)+"]")).length)return $("html,body").animate({scrollTop:e.offset().top},1e3),!1})})});